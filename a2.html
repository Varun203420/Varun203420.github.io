<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HCDE 439 – Assignment 2 (Fade + Button)</title>

  <style>
    /* Layout */
    :root { color-scheme: light; }
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      line-height: 1.6;
      background:#fafafa; color:#1f2937; margin:0;
    }
    .container{
      max-width: 900px;  /* prevents the “zoomed” look */
      margin: 2rem auto;
      padding: 0 1rem;
    }
    section{
      background:#fff; border:1px solid #e5e7eb; border-radius:12px;
      padding:1rem 1.25rem; margin:1rem 0; box-shadow:0 2px 8px rgba(0,0,0,.04);
    }
    h1,h2{ margin:.2rem 0 .6rem; }
    .muted{ color:#6b7280; }

    /* Media */
    img, video{
      display:block; max-width:100%; height:auto;
      border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,.12);
    }
    figure{ margin:1rem 0; }
    figcaption{ color:#6b7280; font-size:.95rem; margin-top:.25rem }
    .media-grid{ display:grid; gap:12px; grid-template-columns:1fr; }
    @media (min-width: 720px){ .media-grid{ grid-template-columns:1fr 1fr; } }

    /* Code */
    pre{ background:#f6f8fa; border:1px solid #e5e7eb; border-radius:10px; padding:1rem; overflow:auto; }
    code{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }

    /* Tables */
    table{ border-collapse:collapse; width:100%; }
    th,td{ border:1px solid #e5e7eb; padding:.5rem .6rem; text-align:left; }
    th{ background:#f3f4f6; }

    /* Orientation quick-fix for sideways photos */
    .rot90  { transform: rotate(90deg);  transform-origin: center; margin:0 auto; }
    .rot-90 { transform: rotate(-90deg); transform-origin: center; margin:0 auto; }
    .figure-wrap { overflow:hidden; }

    /* Keep rotated image from becoming a tall skinny strip */
    .fix-img{
      width:auto;
      height:350px;       /* tweak 300–450px to taste */
      object-fit:contain; /* show whole image inside box */
      border-radius:10px;
      display:block;
      margin:0 auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>HCDE 439 – Assignment 2</h1>
    <p class="muted">Three LEDs (R=3, G=5, B=6) and a pushbutton (D8 → GND using <code>INPUT_PULLUP</code>). One LED mode fades. Code uses <code>analogWrite()</code>, <code>digitalWrite()</code>, <code>digitalRead()</code>, and a <code>for</code> loop.</p>

    <!-- Schematic + Media -->
    <section>
      <h2>The Schematic &amp; Circuit Media</h2>

      <!-- Hand-drawn schematic -->
      <figure>
        <img src="schematic2.png?v=3"
             alt="Hand-drawn schematic (R=3, G=5, B=6 through 330Ω; BTN=8 to GND using INPUT_PULLUP)">
        <figcaption>My hand-drawn wiring: LEDs on pins 3/5/6 through 330 Ω to GND; button on D8 → GND (<code>INPUT_PULLUP</code>).</figcaption>
      </figure>

      <!-- Real circuit photo (rotated + size-fixed) and animated demo -->
      <div class="media-grid">
        <figure class="figure-wrap">
          <!-- If rotation is opposite, swap rot-90 ↔ rot90 -->
          <img class="rot-90 fix-img" src="breadboard-photo.png?v=3" alt="Photo of my actual breadboard circuit">
          <figcaption>Photo of the built circuit (matches the schematic).</figcaption>
        </figure>

        <figure>
          <video src="fade-demo.mp4?v=2" autoplay loop muted playsinline
                 style="max-width:100%; border-radius:10px;"></video>
          <figcaption>Animated demo of the synced fade.</figcaption>
        </figure>
      </div>
    </section>

    <!-- Resistor calculations -->
    <section>
      <h2>Why 330 Ω? (Current-limit calculations)</h2>
      <p>I used <strong>330 Ω</strong> resistors on each LED to limit current from a 5 V Arduino pin. Typical LED forward voltages:</p>
      <ul>
        <li>Red (≈2.0 V): I = (5 − 2.0) / 330 ≈ <strong>9.1 mA</strong></li>
        <li>Green (≈2.2 V): I = (5 − 2.2) / 330 ≈ <strong>8.5 mA</strong></li>
        <li>Blue (≈3.0 V): I = (5 − 3.0) / 330 ≈ <strong>6.1 mA</strong></li>
      </ul>
      <p>All are well under the ~20 mA per-pin guideline and bright enough, so 330 Ω is a safe, conservative choice.</p>
      <p><strong>Why <code>INPUT_PULLUP</code>?</strong> It provides an internal ~20–50 kΩ pull-up so the button reads HIGH when idle and LOW when pressed. When pressed, current is only ~5 V / 30 kΩ ≈ <strong>0.17 mA</strong>, so no external resistor is needed.</p>
    </section>

    <!-- Code -->
    <section>
      <h2>Arduino Code</h2>
      <p>Button cycles modes: <strong>0 = chase</strong> → <strong>1 = all-on</strong> → <strong>2 = synced fade with a hold at min/max</strong>. Includes a short <code>for</code>-loop LED sweep in <code>setup()</code>.</p>
      <pre><code>// HCDE 439 — Button modes: chase / all-on / synced fade-with-hold
// Pins: R=3, G=5, B=6 (each through 330Ω to GND), Button: D8 → GND (INPUT_PULLUP)
// Uses analogWrite(), digitalWrite(), digitalRead(), and a for loop.

// --- Pins ---
const uint8_t LED_R = 3;  // Red
const uint8_t LED_G = 5;  // Green
const uint8_t LED_B = 6;  // Blue
const uint8_t BTN   = 8;  // Pushbutton to GND

// Flip true if common-anode or wired to +5V → LED → resistor → pin
const bool INVERT = false;

// --- Timing ---
const unsigned long DEBOUNCE_MS = 40;
const unsigned long CHASE_MS    = 120;
const unsigned long FADE_STEP_MS= 8;
const uint8_t       FADE_STEP   = 3;
const unsigned long HOLD_MS     = 400;

// --- Mode control ---
uint8_t modeIndex = 2; // start in fade

// --- Button state ---
bool lastBtnReading = HIGH;        // INPUT_PULLUP idle HIGH
unsigned long lastBtnChangeMs = 0;

// --- Chase state ---
uint8_t chaseIdx = 0;
unsigned long lastChaseMs = 0;

// --- Fade state ---
int level = 0, dir = +1;
unsigned long lastFadeMs = 0, holdUntil = 0;

inline void writePWM(uint8_t pin, int v){ if(v&lt;0)v=0; if(v&gt;255)v=255; analogWrite(pin, INVERT ? (255-v) : v); }
inline void ledOn(uint8_t pin){  digitalWrite(pin, INVERT ? LOW  : HIGH); }
inline void ledOff(uint8_t pin){ digitalWrite(pin, INVERT ? HIGH : LOW ); }
inline void allOff(){ ledOff(LED_R); ledOff(LED_G); ledOff(LED_B); }
inline uint8_t ease(uint8_t v){ return (uint16_t(v)*uint16_t(v))/255; } // gamma-ish

void setup(){
  pinMode(LED_R,OUTPUT); pinMode(LED_G,OUTPUT); pinMode(LED_B,OUTPUT);
  pinMode(BTN,INPUT_PULLUP);
  allOff();

  // Required: simple for-loop using digitalWrite
  const uint8_t leds[3]={LED_R,LED_G,LED_B};
  for(int i=0;i&lt;3;i++){ ledOn(leds[i]); delay(80); ledOff(leds[i]); delay(80); }
}

void loop(){
  handleButton();
  if      (modeIndex==0) runChase();
  else if (modeIndex==1) runAllOn();
  else                   runFadeWithHold();
}

void handleButton(){
  bool reading = digitalRead(BTN);                  // digitalRead()
  unsigned long now = millis();
  if(reading != lastBtnReading){ lastBtnReading = reading; lastBtnChangeMs = now; }
  if(now - lastBtnChangeMs &gt;= DEBOUNCE_MS){
    static bool prev=HIGH;
    if(prev==HIGH && reading==LOW){ modeIndex=(modeIndex+1)%3; onModeChange(); }
    prev=reading;
  }
}

void onModeChange(){
  allOff();
  unsigned long now = millis();
  if(modeIndex==0){ chaseIdx=0; lastChaseMs=now; }
  if(modeIndex==2){ level=0; dir=+1; lastFadeMs=now; holdUntil=0; }
}

void runChase(){
  unsigned long now = millis();
  if(now - lastChaseMs &lt; CHASE_MS) return;
  lastChaseMs = now;

  allOff();
  if(chaseIdx==0) ledOn(LED_R);
  if(chaseIdx==1) ledOn(LED_G);
  if(chaseIdx==2) ledOn(LED_B);
  chaseIdx = (chaseIdx+1)%3;
}

void runAllOn(){ ledOn(LED_R); ledOn(LED_G); ledOn(LED_B); }

void runFadeWithHold(){
  unsigned long now = millis();
  if(now &lt; holdUntil){ uint8_t v=ease(level); writePWM(LED_R,v); writePWM(LED_G,v); writePWM(LED_B,v); return; }
  if(now - lastFadeMs &lt; FADE_STEP_MS) return;
  lastFadeMs = now;

  level += dir*FADE_STEP;
  if(level &gt;= 255){ level=255; dir=-1; holdUntil=now+HOLD_MS; }
  else if(level &lt;= 0){ level=0; dir=+1; holdUntil=now+HOLD_MS; }

  uint8_t v = ease(level);
  writePWM(LED_R,v); writePWM(LED_G,v); writePWM(LED_B,v);
}
      </code></pre>
    </section>

    <!-- Additional Questions -->
    <section>
      <h2>Additional Questions</h2>

      <h3>1) Voltage vs. time chart</h3>
      <p>Voltage across an LED for <code>analogWrite(led, 64)</code>, <code>128</code>, and <code>255</code> (conceptual PWM):</p>
      <img src="hcde439_voltage_vs_time.png?v=2" alt="PWM LED voltage vs time chart">

      <h3>2) Battery life with a 1200&nbsp;mAh battery (LEDs only)</h3>
      <p>Using the 330 Ω currents above:</p>
      <ul>
        <li><strong>All-On (255 on all 3):</strong> total ≈ 9.1 + 8.5 + 6.1 ≈ <strong>23.6 mA</strong> → 1200/23.6 ≈ <strong>51 hours</strong></li>
        <li><strong>Fade (~50% avg each):</strong> ≈ 11.8 mA → ≈ <strong>102 hours</strong></li>
        <li><strong>Chase (one LED on at a time):</strong> ≈ 9.1 mA → ≈ <strong>132 hours</strong></li>
      </ul>
      <p class="muted">Note: This ignores the Arduino Uno’s own draw (~40–60 mA), which would shorten real runtimes.</p>

      <h3>3) Measured LED voltage</h3>
      <p><em>Replace with your real DMM reading:</em> Red measured <strong>1.98 V</strong> when ON. Theory ~2.0 V → ~−1% difference (normal part/meter tolerance).</p>

      <h3>4) AI tools usage</h3>
      <p>
        I used AI only to help debug my <code>INPUT_PULLUP</code> button logic and to generate the PWM voltage chart.
        All wiring, testing, and final code decisions were done by me.
      </p>
    </section>
  </div>
</body>
</html>
